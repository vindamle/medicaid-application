{% extends 'base.html' %}

{% block title %}Patient Show Page{% endblock %}

{% block content %}
{% load static %}
{% if user.is_authenticated%}
<div class="overlay" onclick="this.style.display = 'none'">
	<!-- <h1>WOOHOO!</h1> -->
	<img src='{% static "img/confetti.gif" %}'>
</div>
<div class="alertDiv">
	{% for alert in resident_alerts %}
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				<strong>Alert:</strong> {{alert.alert_type.alert_name}} <!-- <button class="btn dismissBtn">Dismiss</button> -->
				<span class="invisible alertId">{{alert.alert_id}}</span>
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
	{% endfor %}
</div>

<div class="container-fluid residentInfoDiv applicationPage" data-application_id="{{application.application_id}}">
	<h1 class="">{{resident.first_name}} {{resident.last_name}}</h1>
	<span class="invisible absolute" id="residentId" type="text">{{resident.resident_id}}</span>
	<ul class="nav nav-tabs">
	{% for application in applications %}
    <li {% if application == applications.last %} class="active"{% endif %}>
      <a data-toggle="tab" href="#application{{application.application_id}}" {% if application == applications.last %} class="active show"{% endif %}>
        App #{{ forloop.counter }}: <span id="app{{application.application_id}}TabPhaseName">{{application.phase.phase_name}}</span>
      </a>
    </li>
	{% endfor %}
  </ul>
<div class="tab-content">
{% for application in applications %}
<div id="application{{application.application_id}}" class="tab-pane {% if application == applications.last %} in active {% else %} fade {% endif %}">
	<h5 id="app{{application.application_id}}showStatus">Status: {{application.phase.phase_name}}</h5>

	<!-- Trigger for Notes Modal -->
	<div class="notesModalBtnDiv">
		<button type="button" class="btn" data-toggle="modal" data-target="#notesModal{{application.application_id}}" id="notesModalBtn">&#128221; Notes</button>
	</div>
	<!-- Notes Modal -->
	<div class="modal fade bd-example-modal-lg" id="notesModal{{application.application_id}}" tabindex="-1" role="dialog" aria-labelledby="notesModal{{application.application_id}}Title" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered " role="document">
	    <div class="modal-content">
	      <div class="">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	        <h5 class="modal-title" id="">Notes</h5>
	      </div>
	      <div class="modal-body">
	        ...Coming Soon!
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
	        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Trigger for Misc Documents Modal -->
	<div class="notesModalBtnDiv">
		<button type="button" class="btn" data-toggle="modal" data-target="#miscDocsModal{{application.application_id}}" id="miscDocsModalBtn">&#128221; Misc. Documents</button>
	</div>
	<!-- Misc Documents Modal -->
	<div class="modal fade bd-example-modal-lg" id="miscDocsModal{{application.application_id}}" tabindex="-1" role="dialog" aria-labelledby="miscDocsModal{{application.application_id}}Title" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered " role="document">
	    <div class="modal-content">
	      <div class="">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	        <h5 class="modal-title" id="">Misc. Documents</h5>
	      </div>
	      <div class="modal-body">
	        ...Coming Soon!
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

	<section>
		<h4 class="collapsibleSection" onclick="collapseSection(this)">Personal Info:</h4>
		<ul class="collapsibleContent">
			<div class="row">
				<div class="col-lg-4 applicationColumn firstColumn">
					<li>
						<label>Resident Name:</label>
						<span class="">{{application.resident.first_name}} {{application.resident.last_name}}</span>
					</li>
					<li>
						<label>Date of Birth:</label>
						<span class="">{{application.resident.dob|date:"M d, Y"}}</span>
					</li>
					<li>
						<label>Facility:</label>
						<span class="">{{application.resident.facility_name}}</span>
					</li>
				</div>
				<div class="col-lg-4 applicationColumn">
					<li class="editableLi">
						<label>Address:</label>
						<input class="editable" id="address" data-table="resident"  type="text" value="{{application.resident.address|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>City:</label>
						<input class="editable" id="city" data-table="resident"  type="text" value="{{application.resident.city|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>State:</label>
						<input class="editable" id="state" data-table="resident"  type="text" value="{{application.resident.state|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Zip:</label>
						<input class="editable" id="zip" data-table="resident"  type="number" value="{{application.resident.zip|default_if_none:''}}">
					</li>
				</div>
				<div class="col-lg-4 applicationColumn">
					<li class="editableLi">
						<label>County:</label>
						<input class="editable" id="county" data-table="resident"  type="text" value="{{application.resident.county|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Phone:</label>
						<input class="editable" id="phone" data-table="resident"  type="tel" value="{{application.resident.phone|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Marital Status:</label>
						<input class="editable" id="marital_status" data-table="resident"  type="text" value="{{application.resident.marital_status|default_if_none:''}}">
					</li>
					<li class="invisible absolute applicationId" id="applicationId" type="text">{{application.application_id}}</li>
					<li class="invisible absolute" id="phase">{{application.phase.phase_id}}</li>
				</div>
			</div>
		</ul>
	</section>
	<section>
		<h4 class="collapsibleSection"  onclick="collapseSection(this)">Insurance Info:</h4>
		<ul class="collapsibleContent">
			<div class="row">
				<div class="col-lg-4 applicationColumn firstColumn">
					<li class="editableLi">
						<label>Primary Payor:</label>
						<input class="editable" id="primary_payor" data-table="resident"  type="text" value="{{application.resident.primary_payor|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Secondary Payor:</label>
						<input class="editable" id="secondary_payor" data-table="resident"  type="text" value="{{application.resident.secondary_payor|default_if_none:''}}">
					</li>
				</div>

				<div class="col-lg-4 applicationColumn">
					<li class="editableLi">
						<label>Copay:</label>
						$<input class="editable" id="copay" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.copay|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Copay Start Date:</label>
						<input class="editable date" id="copay_start_date" data-table="application" data-application_id="{{application.application_id}}"  type="date" value="{{application.copay_start_date|date:'Y-m-d'|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Secondary Insurance Copay Percentage:</label>
						<input class="editable" id="secondary_pays_copay" data-table="application" data-application_id="{{application.application_id}}"  type="number" value="{{application.secondary_pays_copay|default_if_none:''}}" min="0" max="100"> %
					</li>
				</div>
				<div class="col-lg-4 applicationColumn">
					<li class="editableLi">
						<label>Last Medicare Date:</label>
						<input class="editable date" type="date" value="{{application.last_medicare_date|date:'Y-m-d'|default_if_none:''}}">
					</li>
					<li class="editableLi">
						<label>Cut From Medicare/Insurance Date:</label>
						<input class="editable date" type="date" value="{{application.cut_from_medicare_date|date:'Y-m-d'|default_if_none:''}}">
					</li>
				</div>
			</div>
		</ul>
	</section>
		<div id="applicationDiv">
	<section id="applicationInfoSection">
		<span class="invisible applicationId">{{application.application_id}}</span>
		<h4 class="collapsibleSection" onclick="collapseSection(this)">Application Info:</h4>
			<ul class="collapsibleContent">
				<div class="row">
					<div class="col-lg-4 applicationColumn firstColumn">
						<li class="editableLi step1">
							<label>Applicant Meeting Date:</label>
							<input class="editable date" id="appointment_date" data-table="application" data-application_id="{{application.application_id}}"  type="date" value="{{application.appointment_date|date:'Y-m-d'|default_if_none:''}}">
						</li>
						<li class="step1">
							<label class=""><input type="checkbox" class="meetingCheckbox" data-application_id="{{application.application_id}}" {% if application.phase.phase_id > 1 %} checked="checked"{% endif %}>Met with Applicant</label>
						</li>
						<li class="editableLi step2">
							<label>Medicaid Pickup Date:</label>
							<input class="editable date" id="medicaid_pickup_date" data-table="application" data-application_id="{{application.application_id}}" data-alert_id=5 type="date" value="{{application.medicaid_pickup_date|date:'Y-m-d'|default_if_none:''}}">
						</li>
						<li class="step3">
							<label>Application Type:</label>
							<select name="application_type" id="application_type" data-table="application" data-application_id="{{application.application_id}}" onchange="sendInputInfoToDB(this)">
								<option value="">Select one:</option>
								<option value="new_application">New Application</option>
								<option value="conversion">Conversion</option>
								<option value="payor_change">Payor Change</option>
							</select>
							<span class="invisible DBinfo" id="DBapplication_type">{{application.application_type}}</span>
						</li>
					</div>
					<div class="col-lg-4 applicationColumn">
						<li class="step3">
							<label>Spousal/Single:</label>
							<select name="spousal" id="spousal" data-table="application" data-application_id="{{application.application_id}}" onchange="sendInputInfoToDB(this)">
								<option value="">Select one:</option>
								<option value="single">Single</option>
								<option value="spousal">Spousal</option>
							</select>
							<span class="invisible DBinfo" id="DBspousal">{{application.spousal}}</span>
						</li>					
						<li class="editableLi step3">
							<label>Short-term/Long-Term Care:</label>
							<select name="ltc" id="ltc" data-table="application" data-application_id="{{application.application_id}}" onchange="sendInputInfoToDB(this)">
								<option value="">Select one:</option>
								<option value="short_term">Short-Term</option>
								<option value="long_term">Long-Term</option>
							</select>
							<span class="invisible DBinfo" id="DBltc">{{application.ltc}}</span>
						</li>
						<li class="editableLi step3">
							<label>Spousal Refusal:</label>
							<select name="spousal_refusal" id="spousal_refusal" data-table="application" data-application_id="{{application.application_id}}" onchange="sendInputInfoToDB(this)">
								<option value="">Select one:</option>
								<option value="yes">Yes</option>
								<option value="no">No</option>
							</select>
							<span class="invisible DBinfo" id="DBspousal_refusal">{{application.spousal_refusal}}</span>
						</li>
						<li class="editableLi step3">
							<label>Application County:</label>
							<input class="editable" id="application_county" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.application_county|default_if_none:''}}">
						</li>
						<li class="editableLi step3">
							<label>Application State:</label>
							<input class="editable" id="application_state" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.application_state|default_if_none:''}}">
						</li>

						<li class="editableLi step3">
							<label>Estimated NAMI/Income Contribution Amount:</label>
							<br>
							$<input type="text" class="editable" id="estimated_nami" data-table="application" data-application_id="{{application.application_id}}" value="{{application.estimated_nami|floatformat:2|default_if_none:''}}">
						</li>
					</div>
					<div class="col-lg-4 applicationColumn">
						<li class="editableLi step3">
							<label>Date of Deadline:</label>
							<input class="editable date" id="date_of_deadline" data-table="application" data-application_id="{{application.application_id}}"  type="date" value="{{application.date_of_deadline|date:'Y-m-d'|default_if_none:''}}">
						</li>
						<li class="editableLi step3">
							<label>DSS Contact Address:</label>
							<input class="editable" id="dss_contact_address" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.dss_contact_address|default_if_none:''}}">
						</li>
						<li class="editableLi step3">
							<label>DSS Contact Phone:</label>
							<input class="editable" id="dss_contact_phone" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.dss_contact_phone|default_if_none:''}}">
						</li>
						<li class="editableLi step3">
							<label>DSS Contact Email:</label>
							<input class="editable" id="dss_contact_email" data-table="application" data-application_id="{{application.application_id}}"  type="email" value="{{application.dss_contact_email|default_if_none:''}}">
						</li>
						<li class="editableLi step3">
							<label>DSS Contact Fax:</label>
							<input class="editable" id="dss_contact_fax" data-table="application" data-application_id="{{application.application_id}}"  type="text" value="{{application.dss_contact_fax|default_if_none:''}}">
						</li>
					</div>
				</div>
			<hr class= step3">
			<!-- <h6 class="step3" id=Heading">Submission #1</h6> -->
				<div class="row">
					<div class="col-lg-3">
						<li class="step3">
							<input type="checkbox" class="submittedCheckbox" id="submittedCheckbox1" {% if application.phase.phase_id > 3 %} checked="checked"{% endif %}><label for="submittedCheckbox1"class="">Medicaid Application Submitted</label>
						</li>
						<li class="editableLi step3">
							<label>Submission Date:</label>
							<input class="editable date" id="date_of_application_submission" data-table="application" data-application_id="{{application.application_id}}"  type="date" value="{{application.date_of_application_submission|date:'Y-m-d'}}">
						</li>
					</div>
					<div class="col-lg-3">
						<li class="step3">
						{% if application.application_document %}
						<p>Document Uploaded:</p>
						<a href="/{{ application.application_document.file }}" target = "_blank">{{application.application_document.file_name}}</a>
						<button type="button" class="deleteDocBtn" aria-label="Close" onclick="deleteDoc('application',{{application.application_id}},'application_document')">
		          <span aria-hidden="true">&times;</span>
		        </button>
						{% else %}
						<form class="fileInputLi" id="medicaid_application" method="post" enctype="multipart/form-data">
							{% csrf_token %}
							<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Application Here:</label>
							<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
							<input type="hidden" name="resident_id" value="{{application.resident.resident_id}}">
							<input type="hidden" name="file_type" value="medicaid_application">
							<input type="hidden" name="application_id" value="{{application.application_id}}">
							<button type="submit" class="uploadBtn">Upload</button>
						</form>
						{% endif %}
					</li>
					</div>
					<div class="col-lg-3">
						<li class="step4">
							{% if application.application_confirmation %}
							<p>Document Uploaded:</p>
							<a href="/{{ application.application_confirmation.confirmation_document.file }}" target = "_blank">{{application.application_confirmation.confirmation_document.file_name}}</a>
							<button type="button" class="deleteDocBtn" aria-label="Close" onclick="deleteDoc('application',{{application.application_id}},'application_confirmation')">
			          <span aria-hidden="true">&times;</span>
			        </button>
							{% else %}
							<form class="fileInputLi" id="application_confirmation" method="post" enctype="multipart/form-data">
								{% csrf_token %}
								<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Medicaid Confirmation Here:</label>
								<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
								<input type="hidden" name="resident_id" value="{{application.resident.resident_id}}">
								<input type="hidden" name="file_type" value="application_confirmation">
								<input type="hidden" name="application_id" value="{{application.application_id}}">
								<button type="submit" class="uploadBtn">Upload</button>
							</form>
							{% endif %}
						</li>
					</div>
					<div class="col-lg-3">
						<li class="editableLi step4">
							<label>Response:</label>
							<select name="initial_response" id="initial_response" data-table="application" data-application_id="{{application.application_id}}" onchange="sendInputInfoToDB(this);createResponseRow({{application.application_id}}, this)">
								<option value="not_received">Not Received</option>
								<option value="rfi">RFI</option>
								<option value="approved">Approved</option>
								<option value="denied">Denied</option>
							</select>
							<span class="invisible DBinfo" id="DBinitial_response">{{application.initial_response}}</span>
						</li>
						<!-- <li class="invisible absolute" id="application_id">{{application.application_id}}</li> -->
					</div>
				</div>
			</ul>
		</div>
	</section>
	{% for rfi in rfis %}
		{% if rfi.response.application_id == application.application_id %}
			<section class="" id="rfi{{rfi.rfi_id}}" data-application_id="{{rfi.response.application_id}}">
				<h4 class="numberOfRFIs collapsibleSection responseH4" onclick="collapseSection(this)">RFI</h4>
				<ul class="collapsibleContent" id="">
					<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('rfi',{{rfi.rfi_id}})">
		        <span aria-hidden="true">&times;</span>
		      </button>
					<div class="row">
						<div class="col-lg-3 firstColumn applicationColumn">
							<li class="invisible applicationId">
							</li>
							<li class="">
							{% if rfi.document_id %}
								<p>Document Uploaded:</p>
								<a href="/{{ rfi.document.file }}" target = "_blank">{{rfi.document.file_name}}</a>
								<button type="button" class="deleteDocBtn" aria-label="Close" onclick="deleteDoc('rfi',{{rfi.rfi_id}},'document')">
				          <span aria-hidden="true">&times;</span>
				        </button>
							{% else %}
								<form class="fileInputLi rfiFileUpload" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> RFI Here:</label>
									<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
									<input type="hidden" name="resident_id" value="{{rfi.response.application.resident.resident_id}}">
									<input type="hidden" name="file_type" value="rfi">
									<input type="hidden" name="application_id" value="{{rfi.response.application.application_id}}">
									<input type="hidden" name="rfi_id" value="{{rfi.rfi_id}}">
									<button type="submit" class="uploadBtn">Upload</button>
								</form>
							{% endif %}
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi ">
								<label>RFI Due Date:</label>
								<input class="editable date  due_date" id="rfi_due_date" data-table="rfi"  data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" type="date" value="{{rfi.rfi_due_date|date:'Y-m-d'|default_if_none:''}}" onkeyup="checkIfEnterKey(this, event)">
							</li>
							<li class="editableLi">
								<label>Extension Requested?</label>
								<select name="rfi_extension_request" id="rfi_extension_request" data-table="rfi" data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" onchange="sendInputInfoToDB(this); extensionRequested(this, {{rfi.response.application.application_id}}, {{rfi.rfi_id}})">
									<option value="no">No</option>
									<option value="yes">Yes</option>
								</select>
								<span class="invisible DBinfo" id="DBrfi_extension_request">{{rfi.rfi_extension_request}}</span>
							</li>
							<li class="editableLi {% if rfi.rfi_extension_request != 'yes' %} invisible {% endif %}">
								<label>Extension Granted?</label>
								<select name="rfi_extension_response" id="rfi_extension_response" data-table="rfi" data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" onchange="sendInputInfoToDB(this); newRfiDueDatePrompt(this)">
									<option value="no">No</option>
									<option value="yes">Yes</option>
								</select>
								<span class="invisible DBinfo" id="DBrfi_extension_response">{{rfi.rfi_extension_response}}</span>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="">
								<label><input type="checkbox" class="documentationSubmittedCheckbox " id="rfi_documentation_submitted" data-table="rfi" data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" ${checked}>Documentation Submitted</label>
							</li>
							<li class="editableLi step5 ">
								<label>Submission Date:</label>
								<input class="editable date " id="rfi_documentation_submitted_date" data-table="rfi"  data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" type="date" value="{{rfi.rfi_documentation_submitted_date|date:'Y-m-d'|default_if_none:''}}" onkeyup="checkIfEnterKey(this, event)">
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi step5 ">
								<label>Response:</label>
								<select name="response_select" class=" responseSelect" id="rfi_response" data-table="rfi" data-application_id="{{rfi.response.application.application_id}}" data-rfi_id="{{rfi.rfi_id}}" onchange="sendInputInfoToDB(this); createResponseRow({{rfi.response.application.application_id}}, this)">
									<option value="not_received">Not Received</option>
									<option value="rfi">RFI</option>
									<option value="approved">Approved</option>
									<option value="denied">Denied</option>
								</select>
								<span class="invisible DBinfo" id="DBrfi_response">{{rfi.rfi_response}}</span>
							</li>
						</div>
					</div>
				</ul>
			</section>
		{%endif%}
	{% endfor %} <!-- end of rfi for loop -->
	{% for denial in denials %}
		{% if denial.response.application_id == application.application_id %}
			<section class="" id="denial{{denial.denial_id}}">
				<h4 class="numberOfRFIs collapsibleSection responseH4" onclick="collapseSection(this)">Denial</h4>
				<ul class="collapsibleContent" id="">
					<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('denial',{{denial.denial_id}})">
		        <span aria-hidden="true">&times;</span>
		      </button>
					<div class="row">
						<div class="col-lg-3 firstColumn applicationColumn">
							<li class="">
							{% if denial.document_id %}
								<p>Document Uploaded:</p>
								<a href="/{{ denial.document.file }}" target = "_blank">{{denial.document.file_name}}</a>
								<button type="button" class="deleteDocBtn" aria-label="Close" onclick="deleteDoc('denial',{{denial.denial_id}},'document')">
				          <span aria-hidden="true">&times;</span>
				        </button>
							{% else %}
								<form class="fileInputLi denialFileUpload" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Denial Here:</label>
									<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
									<input type="hidden" name="resident_id" value="{{denial.response.application.resident.resident_id}}">
									<input type="hidden" name="file_type" value="denial">
									<input type="hidden" name="application_id" value="{{denial.response.application_id}}">
									<input type="hidden" name="denial_id" value="{{denial.denial_id}}">
									<button type="submit" class="uploadBtn">Upload</button>
								</form>
							{% endif %}
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi ">
								<label>Denial Notice Date:</label>
								<input class="editable date  due_date" id="denial_notice_date" data-table="denial"  data-application_id="{{denial.response.application_id}}" data-denial_id="{{denial.denial_id}}" type="date" onkeyup="checkIfEnterKey(this, event)">
							</li>
							<li class="editableLi">
								<label>Fair Hearing Requested?</label>
								<select name="denial_fair_hearing_request" id="denial_fair_hearing_request" data-table="denial" data-application_id="{{denial.response.application_id}}" data-denial_id="{{denial.denial_id}}" onchange="sendInputInfoToDB(this); fairHearingRequested(this, {{denial.response.application_id}}, {{denial.denial_id}})">
									<option value="no">No</option>
									<option value="yes">Yes</option>
								</select>
								<span class="invisible DBinfo" id="DBdenial_fair_hearing_request">{{denial.denial_fair_hearing_request}}</span>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="">
								<label><input type="checkbox" class="documentationSubmittedCheckbox " id="denial_documentation_submitted" data-table="denial" data-application_id="{{denial.response.application_id}}" data-denial_id="{{denial.denial_id}}">Documentation Submitted</label>
							</li>
							<li class="editableLi step5 ">
								<label>Submission Date:</label>
								<input class="editable date " id="denial_documentation_submitted_date" data-table="denial"  data-application_id="{{denial.response.application_id}}" data-denial_id="{{denial.denial_id}}" type="date" onkeyup="checkIfEnterKey(this, event)">
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li>
								<button type="button" class="btn btn-primary" id="createNewApp" onclick="createNewApp()">Create New Application</button>
							</li>
						</div>
					</div>
				</ul>
			</section>
		{%endif%}
	{% endfor %}<!-- end of denials loop -->
	{% for approval in approvals %}
		{% if approval.response.application_id == application.application_id %}
			<section class="" id="approval{{approval.approval_id}}">
			<h4 class="collapsibleSection responseH4"  onclick="collapseSection(this)">Approval</h4>
			<ul class="collapsibleContent">
				<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('approval',{{approval.approval_id}})">
	        <span aria-hidden="true">&times;</span>
	      </button>
				<div class="row">
					<div class=" col-lg-2 applicationColumn firstColumn">
						<li class="editableLi">
							<label>Approval Notice Date:</label>
							 <input class="editable date" id="approval_notice_date" data-table="approval" data-approval_id="{{approval.approval_id}}"  type="date" value="{{approval.approval_notice_date|date:'Y-m-d'}}">
						</li>
					</div>
					<div class=" col-lg-3 applicationColumn">
						<li class="editableLi">
							<label>Approval Start Date:</label>
							 <input class="editable date" id="approval_start_date" data-table="approval" data-approval_id="{{approval.approval_id}}"  type="date" value="{{approval.approval_start_date|date:'Y-m-d'}}">
						</li>
						<li class="editableLi">
							<label>Approval End Date:</label>
							 <input class="editable date" id="approval_end_date" data-table="approval" data-approval_id="{{approval.approval_id}}"  type="date" value="{{approval.approval_end_date|date:'Y-m-d'}}">
						</li>
						<li class="editableLi">
							<label>Recertification Date:</label>
							<input class="editable date" type="date" id="approval_recertification_date" value="{{approval.approval_recertification_date|date:'Y-m-d'}}" data-table="approval" data-approval_id="{{approval.approval_id}}">
						</li>
					</div>
					<div class="col-lg-4 applicationColumn">
						<li class="">
						{% if approval.document_id %}
							<p>Document Uploaded:</p>
							<a href="/{{ approval.document.file }}" target = "_blank">{{approval.document.file_name}}</a>
							<button type="button" class="deleteDocBtn" aria-label="Close" onclick="deleteDoc('approval',{{approval.approval_id}},'document')">
			          <span aria-hidden="true">&times;</span>
			        </button>
						{% else %}
							<form class="fileInputLi" id="approval" method="post" enctype="multipart/form-data">
				  			{% csrf_token %}
								<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Approval Here:</label>
								<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
								<input type="hidden" name="resident_id" value="{{approval.response.application.resident.resident_id}}">
								<input type="hidden" name="application_id" value="{{approval.response.application_id}}">
								<input type="hidden" name="approval_id" value="{{approval.approval_id}}">
								<input type="hidden" name="file_type" value="approval">
								<button type="submit" class="uploadBtn">Upload</button>
							</form>
						{% endif %}
						</li>
						<!-- <li class="editableLi">
							<label>Fair Hearing Required?</label>
							<select name="fair_hearing_required" id="fair_hearing_required" data-table="approval" data-approval_id="{{approval.approval_id}}"  onchange="sendInputInfoToDB(this)">
								<option value="">Select one:</option>
								<option value="yes">Yes</option>
								<option value="no">No</option>
							</select>
							<span class="invisible DBinfo" id="DBspousal_refusal">{{approval.fair_hearing_required}}</span>
						</li> -->

								
							<div class="modal fade bd-example-modal-lg" id="namiModal{{approval.approval_id}}" tabindex="-1" role="dialog" aria-labelledby="namiModalTitle" aria-hidden="true">
							  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
							    <div class="modal-content">
							      <div class="">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							          <span aria-hidden="true">&times;</span>
							        </button>
							        <h5 class="modal-title" id="exampleModalLongTitle">NAMIs</h5>
							      </div>
							      <div class="modal-body">
										{% for nami in namis %}
											{% if nami.approval.approval_id == approval.approval_id %}
												<div class="modalRowDiv">
													<button type="button" class="close" onclick="removeModalRow(this, {{nami.nami_id}}, 'nami')">
									          <span >&times;</span>
									        </button>
													<h6 class="namiH6">NAMI</h6>
													<div class="row modalRow">
														<div class="col-lg-4 col-sm-12 modalRowColumn">
															<li>
																<label>NAMI Start Date:</label>
																<input class="editable date" id="nami_start_date" data-table="nami" data-nami_id="{{nami.nami_id}}" type="date" value="{{nami.nami_start_date|date:'Y-m-d'}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-4 col-sm-12 modalRowColumn">
															<li>
																<label>NAMI End Date:</label>
																<input class="editable date" id="nami_end_date" data-table="nami" data-nami_id="{{nami.nami_id}}" type="date" value="{{nami.nami_end_date|date:'Y-m-d'}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-4 col-sm-12 modalRowColumn">
															<li>
																<label>Amount:</label>
																$<input type="number" class="editable" id="nami_amount" data-table="nami" data-nami_id="{{nami.nami_id}}" value="{{nami.nami_amount|floatformat:2}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
													</div>
												</div>
											{%endif%}
										{% endfor %}
     								</div>
      							<div class="modal-footer">
								      <div class="editableLi addNamiBtnLi">
												<button class="addModalRowBtn" onclick="addNAMIRowHTML(this, {{approval.approval_id}})">Add NAMI &#x271A; </button>
											</div>
       								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
     								</div>
   								</div>
							  </div>
							</div>




						</div>
						<div class="col-lg-3 applicationColumn">
							<li>
						<!-- Button trigger modal -->
								<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#namiModal{{approval.approval_id}}" id="namiModalBtn">View/Add NAMIs</button>
							</li>
							<li class="editableLi step6">
								<label>Satisfied with approval?</label>
								<select name="approval_satisfied" id="approval_satisfied" data-table="approval" data-approval_id="{{approval.approval_id}}"  onchange="sendInputInfoToDB(this); revealNextNotSatisfiedStep(this, 1)">
									<option value="">Select one:</option>
									<option value="yes">Yes</option>
									<option value="no">No</option>
								</select>
								<span class="invisible DBinfo" id="DBapproval_satisfied">{{approval.approval_satisfied}}</span>
							</li>
						</div>
					</div>
					<hr class="notSatisfied">
					<div class="row notSatisfiedRow">
						<div class="col-lg-4">
							<li class="editableLi notSatisfied notSatisfied1">
								<label>Contacted DSS?</label>
								<select name="approval_contacted_dss" id="approval_contacted_dss" data-table="approval" data-approval_id="{{approval.approval_id}}"  onchange="sendInputInfoToDB(this);revealNextNotSatisfiedStep(this, 2)">
									<option value="">Select one:</option>
									<option value="yes">Yes</option>
									<option value="no">No</option>
								</select>
								<span class="invisible DBinfo" id="DBapproval_contacted_dss">{{approval.approval_contacted_dss}}</span>
							</li>
						</div>
						<div class="col-lg-4">
							<li class="editableLi notSatisfied notSatisfied2">
								<label>Resolved through DSS?</label>
								<select name="approval_resolved_through_dss" id="approval_resolved_through_dss" data-table="approval" data-approval_id="{{approval.approval_id}}"  onchange="sendInputInfoToDB(this);revealNextNotSatisfiedStep(this, 3)">
									<option value="">Select one:</option>
									<option value="yes">Yes</option>
									<option value="no">No</option>
								</select>
								<span class="invisible DBinfo" id="DBapproval_resolved_through_dss">{{approval.approval_resolved_through_dss}}</span>
							</li>
						</div>
						<div class="col-lg-4">
							<!-- Button trigger modal -->
								<button type="button" class="btn btn-primary notSatisfied notSatisfied3" data-toggle="modal" data-target="#fairHearingsModal{{approval.approval_id}}" id="fairHearingsModalBtn">View/Add Fair Hearing Info</button>
						</div>

								<div class="modal fade bd-example-modal-lg fairHearingsModal" id="fairHearingsModal{{approval.approval_id}}" tabindex="-1" role="dialog" aria-labelledby="fairHearingsModalTitle" aria-hidden="true">
							  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
							    <div class="modal-content">
							      <div class="">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							          <span aria-hidden="true">&times;</span>
							        </button>
							        <h5 class="modal-title" id="exampleModalLongTitle">Fair Hearings</h5>
							      </div>
							      <div class="modal-body">
										{% for fair_hearing in fair_hearings %}
											{% if fair_hearing.response.response_id == approval.response.response_id %}
												<div class="modalRowDiv">
													<button type="button" class="close" onclick="removeModalRow(this, {{fair_hearing.fair_hearing_id}}, 'fair_hearing')">
									          <span >&times;</span>
									        </button>
													<h6 class="fairHearingH6">Fair Hearing</h6>
													<div class="row modalRow">
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Date:</label>
																<input class="editable date" id="fair_hearing_date" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" type="date" value="{{fair_hearing.fair_hearing_date|date:'Y-m-d'}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Time:</label>
																<input class="editable time" id="fair_hearing_time" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" type="time" value="{{fair_hearing.fair_hearing_time|time:'H:i'}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Address:</label>
																<input type="text" class="editable" id="fair_hearing_address" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" value="{{fair_hearing.fair_hearing_address}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Outcome:</label>
																<input type="text" class="editable" id="fair_hearing_outcome" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" value="{{fair_hearing.fair_hearing_outcome}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Attorney's Name:</label>
																<input type="text" class="editable" id="fair_hearing_attorney_first_name" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" value="{{fair_hearing.fair_hearing_attorney_first_name}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Regional's Name:</label>
																<input type="text" class="editable" id="fair_hearing_regional_first_name" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" value="{{fair_hearing.fair_hearing_regional_first_name}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
														<div class="col-lg-6 col-sm-12 modalRowColumn">
															<li>
																<label>Coordinator's Name:</label>
																<input type="text" class="editable" id="fair_hearing_coordinator_first_name" data-table="fair_hearing" data-fair_hearing_id="{{fair_hearing.fair_hearing_id}}" value="{{fair_hearing.fair_hearing_coordinator_first_name}}" onkeyup="checkIfEnterKey(this, event)">
															</li>
														</div>
													</div>
												</div>
											{%endif%}
										{% endfor %}
     								</div>
      							<div class="modal-footer">
								      <div class="editableLi addNamiBtnLi">
												<button class="addModalRowBtn" onclick="addFairHearingRowHTML(this, {{approval.response.response_id}})">Add Fair Hearing &#x271A; </button>
											</div>
       								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
     								</div>
   								</div>
							  </div>
							</div>


					</div>
				</ul>
			</section>
		{% endif %}
	{% endfor %} <!-- end of approvals for loop -->
</div><!-- end of applicationDiv-->
{% endfor %} <!-- end of for application in applications loop -->
</div>
</div>
{% else %}
  <p>You are not logged in</p>
  <a href="{% url 'login' %}">login</a>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{% static 'js/show.js' %}"></script>
<script type="text/javascript">
const residentId = document.querySelector('#residentId').innerHTML;
$(document).ready(()=>{
	// let numberOfNAMIs;
	let html = "";
	let numberOfApprovals = 0;

	{% for application in applications %}
		
		var applicationDiv = document.querySelector('#application{{application.application_id}}');
		var initial_response = applicationDiv.querySelector('#initial_response');
		var date_of_application_submission = applicationDiv.querySelector('#date_of_application_submission');
		
		date_of_application_submission.addEventListener('blur', (e) => {
			if(date_of_application_submission.value) {
				$(`#${applicationDiv.id} .step4`).fadeIn();
				phaseChange(date_of_application_submission, 4);
			} else {
				$(`#${applicationDiv.id} .step4`).css('display', 'none');
				phaseChange(date_of_application_submission, 3);
			}
		})

		if(date_of_application_submission.value) {
			$(`#${applicationDiv.id} .step4`).css('display', 'block');
		}

		var approval_satisfied = applicationDiv.querySelector('#approval_satisfied');
		if (approval_satisfied && approval_satisfied.value != "no") {
			$(`#${applicationDiv.id} .notSatisfied`).css('display', 'none')
		} 

		var meetingCheckbox = applicationDiv.querySelector('.meetingCheckbox');

		if(meetingCheckbox.checked) {
			$(`#${applicationDiv.id} .step2`).css('display', 'block');
		}

		meetingCheckbox.addEventListener('change', () => {
			if(meetingCheckbox.checked) {
				if (!$(`#${applicationDiv.id} #appointment_date`).val()){
					alert("Please enter a meeting date")
					meetingCheckbox.checked = false;
					return;
				}
				$(`#${applicationDiv.id} .step2`).fadeIn();
				 phaseChange(meetingCheckbox, 2);
			} else {
				$(`#${applicationDiv.id} .step2`).css('display', 'none');
				$(`#${applicationDiv.id} .step3`).css('display', 'none');
				 phaseChange(meetingCheckbox, 1);
			}
		})

		var pickup_date = applicationDiv.querySelector('#medicaid_pickup_date');
		if(pickup_date.value != "") {
			$(`#${applicationDiv.id} .step3`).css('display', 'block');
		}

	{% endfor %}

	{% for approval in approvals %}
		var approvalSection = document.querySelector('#approval{{approval.approval_id}}')
		var satisfied = approvalSection.querySelector('#DBapproval_satisfied')
		if (satisfied.innerHTML == 'no') {
			$('#approval{{approval.approval_id}} .notSatisfied').css('display', 'block');
		}
	{% endfor %}

	// Make select fields default to value in database (if there is one):
	const selectFields = document.querySelectorAll('SELECT');
	for (let i = 0; i < selectFields.length; i++) {
		const selectField = selectFields[i];
		const selectFieldParent = selectField.parentNode;
		const DBinfo = selectFieldParent.querySelector('.DBinfo').innerHTML;
		const options = selectField.querySelectorAll('OPTION');
		for (let x = 0; x < options.length; x++) {
			const option = options[x];
			if (option.value == DBinfo) {
				option.setAttribute("selected", "selected");
			};
		};
	};

}) // end document.ready

const collapseSection = (h4) => {
	h4.classList.toggle("activeSection");
  let content = h4.nextElementSibling;
  if (content.style.maxHeight != "0px"){
    content.style.maxHeight = "0px";
    content.parentNode.style.maxWidth = "100px";
    content.parentNode.style.marginBottom = "30px";
  } else {
    content.style.maxHeight = content.scrollHeight + "0px";
    content.parentNode.style.maxWidth = "100%";
    content.parentNode.style.marginBottom = "20px";
  }
}

class ResponseRowHTML {
	constructor (applicationId,responseId) {
		this.rfiRowHtml = `
			<section class="" id="rfi${responseId}">
				<h4 class="numberOfRFIs collapsibleSection responseH4" onclick="collapseSection(this)">RFI #${numberOfRFIs}</h4>
				<ul class="collapsibleContent" id="">
					<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('rfi',${responseId})">
		        <span aria-hidden="true">&times;</span>
		      </button>
					<div class="row">
						<div class="col-lg-3 firstColumn applicationColumn">
							<li class="">
								<form class="fileInputLi rfiFileUpload" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> RFI Here:</label>
									<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
									<input type="hidden" name="resident_id" value="${residentId}">
									<input type="hidden" name="file_type" value="rfi">
									<input type="hidden" name="application_id" value="${applicationId}">
									<input type="hidden" name="rfi_id" value="${responseId}">
									<button type="submit" class="uploadBtn">Upload</button>
								</form>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi ">
								<label>RFI Due Date:</label>
								<input class="editable date  due_date" id="rfi_due_date" data-table="rfi"  data-application_id="${applicationId}" data-rfi_id="${responseId}" type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
							</li>
							<li class="editableLi">
								<label>Extension Requested?</label>
								<select name="rfi_extension_request" id="rfi_extension_request" data-table="rfi" data-application_id="${applicationId}" data-rfi_id="${responseId}" onchange="sendInputInfoToDB(this); extensionRequested(this, ${applicationId}, ${responseId})">
									<option value="no">No</option>
									<option value="yes">Yes</option>
								</select>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="">
								<label><input type="checkbox" class="documentationSubmittedCheckbox " id="rfi_documentation_submitted" data-table="rfi" data-application_id="${applicationId}" data-rfi_id="${responseId}">Documentation Submitted</label>
							</li>
							<li class="editableLi step5 ">
								<label>Submission Date:</label>
								<input class="editable date " id="rfi_documentation_submitted_date" data-table="rfi"  data-application_id="${applicationId}" data-rfi_id="${responseId}" type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi step5 ">
								<label>Response:</label>
								<select name="response_select" class=" responseSelect" id="rfi_response" data-table="rfi" data-application_id="${applicationId}" data-rfi_id="${responseId}" onchange="createResponseRow(${applicationId}, this); sendInputInfoToDB(this)">
									<option value="not_received">Not Received</option>
									<option value="rfi">RFI</option>
									<option value="approved">Approved</option>
									<option value="denied">Denied</option>
								</select>
							</li>
						</div>
					</div>
				</ul>
			</section>
		`

		this.approvedRowHtml = `
			<section class="" id="approval${responseId}">
				<h4 class="numberOfApprovals collapsibleSection responseH4" onclick="collapseSection(this)">Approval</h4>
				<ul class="collapsibleContent" id="">
					<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('approval',${responseId})">
		        <span aria-hidden="true">&times;</span>
		      </button>
					<div class="row">
					<div class=" offset-lg-2 col-lg-3 applicationColumn">
					<li class="editableLi">
							<label>Approval Notice Date:</label>
							 <input class="editable date" id="approval_notice_date" data-table="approval" data-approval_id="${responseId}"  type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</li>
						<li class="editableLi">
							<label>Approval Start Date:</label>
							 <input class="editable date" id="approval_start_date" data-table="approval" data-approval_id="${responseId}"  type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</li>
						<li class="editableLi">
							<label>Approval End Date:</label>
							 <input class="editable date" id="approval_end_date" data-table="approval" data-approval_id="${responseId}"  type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</li>
					</div>
					<div class="col-lg-4 applicationColumn">

						<li class="editableLi">
							<label>Recertification Date:</label>
							<input class="editable date" type="date" id="approval_recertification_date" data-table="approval" data-approval_id="${responseId}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</li>
						<li class="">
							<form class="fileInputLi" id="approval" method="post" enctype="multipart/form-data">
				  			{% csrf_token %}
								<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Approval Here:</label>
								<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
								<input type="hidden" name="resident_id" value="${residentId}">
								<input type="hidden" name="application_id" value="${applicationId}">
								<input type="hidden" name="approval_id" value="${responseId}">
								<input type="hidden" name="file_type" value="approval">
								<button type="submit" class="uploadBtn">Upload</button>
							</form>
						</li>
					`
						// numberOfNAMIs = 1;
	  this.approvedRowHtml += `
			<div class="modal fade bd-example-modal-lg" id="namiModal${responseId}" tabindex="-1" role="dialog" aria-labelledby="namiModalTitle" aria-hidden="true">
			  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			    <div class="modal-content">
			      <div class="">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			        <h5 class="modal-title" id="exampleModalLongTitle">NAMIs</h5>
			      </div>
			     <div class="modal-body">
					</div>
	      <div class="modal-footer">
		      <div class="editableLi addNamiBtnLi">
						<button class="addModalRowBtn" onclick="addNAMIRowHTML(this, ${responseId})">Add NAMI &#x271A; </button>
					</div>
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		      </div>
		    </div>
		  </div>
		</div>
	`

		this.approvedRowHtml += `
			<div class="modal fade bd-example-modal-lg fairHearingsModal" id="fairHearingsModal${responseId}" tabindex="-1" role="dialog" aria-labelledby="fairHearingsModalTitle" aria-hidden="true">
							  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
							    <div class="modal-content">
							      <div class="">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							          <span aria-hidden="true">&times;</span>
							        </button>
							        <h5 class="modal-title" id="exampleModalLongTitle">Fair Hearings</h5>
							      </div>
							      <div class="modal-body">
										</div>
      							<div class="modal-footer">
								      <div class="editableLi addNamiBtnLi">
												<button class="addModalRowBtn" onclick="addFairHearingRowHTML(this, ${responseId})">Add Fair Hearing &#x271A; </button>
											</div>
       								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
     								</div>
   								</div>
							  </div>
							</div>
		`

		this.approvedRowHtml += `
			</div>
			<div class="col-lg-3 applicationColumn">
				<li>
					<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#namiModal${responseId}" id="namiModalBtn">View/Add NAMIs</button>
				</li>
				<li class="editableLi step6">
						<label>Satisfied with approval?</label>
						<select name="approval_satisfied" id="approval_satisfied" data-table="approval" data-approval_id="${responseId}" onchange="sendInputInfoToDB(this); revealNextNotSatisfiedStep(this, 1)">
							<option value="">Select one:</option>
							<option value="yes">Yes</option>
							<option value="no">No</option>
						</select>
					</li>
			</div>
		</div>
		<div class="row satisfiedRow">
				<div class="col-lg-4">
					<li class="editableLi notSatisfied notSatisfied1">
						<label>Contacted DSS?</label>
						<select name="approval_contacted_dss" id="approval_contacted_dss" data-table="approval" data-approval_id="${responseId}" onchange="sendInputInfoToDB(this);revealNextNotSatisfiedStep(this, 2)">
							<option value="">Select one:</option>
							<option value="yes">Yes</option>
							<option value="no">No</option>
						</select>
					</li>
				</div>
				<div class="col-lg-4">
					<li class="editableLi notSatisfied notSatisfied2">
						<label>Resolved through DSS?</label>
						<select name="approval_resolved_through_dss" id="approval_resolved_through_dss" data-table="approval" data-approval_id="${responseId}" onchange="sendInputInfoToDB(this);revealNextNotSatisfiedStep(this, 3)">
							<option value="">Select one:</option>
							<option value="yes">Yes</option>
							<option value="no">No</option>
						</select>
					</li>
				</div>
				<div class="col-lg-4">
					<button type="button" class="btn btn-primary notSatisfied notSatisfied3" data-toggle="modal" data-target="#fairHearingsModal${responseId}" id="fairHearingsModalBtn">View/Add Fair Hearing Info</button>
				</div>
			</div>
	</ul>
</section>
`
		this.deniedRowHtml = `
			<section class="" id="denial${responseId}">
				<h4 class="numberOfDenials collapsibleSection responseH4" onclick="collapseSection(this)">Denial</h4>
				<ul class="collapsibleContent" id="">
					<button type="button" class="deleteResponseBtn" aria-label="Close" onclick="deleteResponse('denial',${responseId})">
		        <span aria-hidden="true">&times;</span>
		      </button>
					<div class="row">
						<div class="col-lg-3 firstColumn applicationColumn">
							<li class="">
								<form class="fileInputLi denialFileUpload" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<label>Choose or <span class="dragNDropText">Drag n' Drop<sup>TM</sup></span> Denial Here:</label>
									<input type="file" name="document" value="" accept="image/jpeg,image/png,application/pdf" required>
									<input type="hidden" name="resident_id" value="${residentId}">
									<input type="hidden" name="file_type" value="denial">
									<input type="hidden" name="application_id" value="${applicationId}">
									<input type="hidden" name="denial_id" value="${responseId}">
									<button type="submit" class="uploadBtn">Upload</button>
								</form>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="editableLi ">
								<label>Denial Notice Date:</label>
								<input class="editable date  due_date" id="denial_notice_date" data-table="denial"  data-application_id="${applicationId}" data-denial_id="${responseId}" type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
							</li>
							<li class="editableLi">
								<label>Fair Hearing Requested?</label>
								<select name="denial_fair_hearing_request" id="denial_fair_hearing_request" data-table="denial" data-application_id="${applicationId}" data-denial_id="${responseId}" onchange="sendInputInfoToDB(this); fairHearingRequested(this, ${applicationId}, ${responseId})">
									<option value="no">No</option>
									<option value="yes">Yes</option>
								</select>
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li class="">
								<label><input type="checkbox" class="documentationSubmittedCheckbox " id="denial_documentation_submitted" data-table="denial" data-application_id="${applicationId}" data-denial_id="${responseId}">Documentation Submitted</label>
							</li>
							<li class="editableLi step5 ">
								<label>Submission Date:</label>
								<input class="editable date " id="denial_documentation_submitted_date" data-table="denial"  data-application_id="${applicationId}" data-denial_id="${responseId}" type="date" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
							</li>
						</div>
						<div class="col-lg-3 applicationColumn">
							<li>
								<button type="button" class="btn btn-primary" id="createNewApp" onclick="createNewApp()">Create New Application</button>
							</li>
						</div>
					</div>
				</ul>
			</section>
		`
	}
}

const addNAMIRowHTML = (addNamiBtn, approvalId) => {
	const ajaxCall = $.ajax(
		{
			type:"GET",
			url: `/application/ajax/create_nami`,
			data: {
				approval_id: approvalId
			},
			success: function(namiId) {
				const html = `
					<div class="modalRow">
						<button type="button" class="close" onclick="removeModalRow(this, ${namiId},'nami')">
		          <span >&times;</span>
		        </button>
						<h6 class="namiH6">NAMI:</h6>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>NAMI Start Date:</label>
							<input class="editable date" id="nami_start_date" data-table="nami" data-nami_id="${namiId}" type="date" value="{{nami.nami_start_date|date:'Y-m-d'}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>NAMI End Date:</label>

							<input class="editable date" id="nami_end_date" data-table="nami" data-nami_id="${namiId}" type="date" value="{{nami.nami_end_date|date:'Y-m-d'}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>Amount:</label>
							$<input type="number" class="editable" id="nami_amount" data-table="nami" data-nami_id="${namiId}" value="{{nami.nami_amount|floatformat:2}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
					</div>
				`
				const modalBody = addNamiBtn.parentNode.parentNode.parentNode.querySelector('.modal-body');
				console.log(modalBody)
				modalBody.insertAdjacentHTML('beforeend', html)
				// numberOfNAMIs += 1;
			}
		});
}

const addFairHearingRowHTML = (addFairHearingBtn, responseId) => {
	const ajaxCall = $.ajax(
		{
			type:"GET",
			url: `/application/ajax/create_fair_hearing`,
			data: {
				response_id: responseId
			},
			success: function(fairHearingId) {
				const html = `
					<div class="modalRow">
						<button type="button" class="close" onclick="removeModalRow(this, ${fairHearingId},'fair_hearing')">
		          <span >&times;</span>
		        </button>
						<h6 class="fairHearingH6">Fair Hearing:</h6>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>Fair Hearing Start Date:</label>
							<input class="editable date" id="fair_hearing_start_date" data-table="fair_hearing" data-fair_hearing_id="${fairHearingId}" type="date" value="{{fair_hearing.fair_hearing_start_date|date:'Y-m-d'}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>Fair Hearing End Date:</label>

							<input class="editable date" id="fair_hearing_end_date" data-table="fair_hearing" data-fair_hearing_id="${fairHearingId}" type="date" value="{{fair_hearing.fair_hearing_end_date|date:'Y-m-d'}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
						<div class="col-lg-4 col-sm-12 modalRowColumn">
						<label>Amount:</label>
							$<input type="number" class="editable" id="fair_hearing_amount" data-table="fair_hearing" data-fair_hearing_id="${fairHearingId}" value="{{fair_hearing.fair_hearing_amount|floatformat:2}}" onblur="sendInputInfoToDB(this)" onkeyup="checkIfEnterKey(this, event)">
						</div>
					</div>
				`
				const modalBody = addFairHearingBtn.parentNode.parentNode.parentNode.querySelector('.modal-body');
				console.log(modalBody)
				modalBody.insertAdjacentHTML('beforeend', html)
				// numberOfFairHearings += 1;
			}
		});
}

const removeModalRow = (removeModalRowBtn, modalRowId, rowType) => {
	if(confirm("Delete this row?")) {
		const ajaxCall = $.ajax(
			{
				type:"GET",
				url: `/application/ajax/delete_${rowType}`,
				data: {
				row_id: modalRowId
			},
			success: function() {
				console.log("Row deleted");
				const modalRow = removeModalRowBtn.parentNode;
				$(modalRow).fadeOut();
			}
		});
	}
}

const extensionRequested = (extensionRequestedField,applicationId,rfiId) => {
	const col = extensionRequestedField.parentNode.parentNode;
	const html = `
	<li class="editableLi">
		<label>Extension Granted?</label>
		<select name="rfi_extension_response" id="rfi_extension_response" data-table="rfi" data-application_id="${applicationId}" data-rfi_id="${rfiId}" onchange="sendInputInfoToDB(this); newRfiDueDatePrompt(this)">
			<option value="no">No</option>
			<option value="yes">Yes</option>
		</select>
	</li>
	`
	col.insertAdjacentHTML("beforeend", html);
}

const newRfiDueDatePrompt = selectField => {
	if (selectField.value == "yes") {
		alert("Please enter a new RI Due Date");
 		const dueDateField = selectField.parentNode.parentNode.querySelector('#rfi_due_date');
  	dueDateField.focus();
	}
}

let numberOfRFIs = 0;
const createResponseRow = (applicationId, responseField) => {
	const ajaxCall = $.ajax(
		{
			type:"GET",
			url: `/application/ajax/create_response`,
			data: {
				application_id: applicationId,
				response_type: responseField.value
			},
			success: function(responseId) {
				if (responseId != 'no response created for not_received') {
					newResponseRowHTML = new ResponseRowHTML(applicationId, responseId)
					const applicationDiv = document.querySelector(`#application${applicationId}`)
					applicationDiv.insertAdjacentHTML("beforeend", newResponseRowHTML[`${responseField.value}RowHtml`]);
				}	
			}
		});
	if (responseField.value == "rfi") {
		phaseChange(responseField, 5);
		numberOfRFIs += 1;
	} else if (responseField.value == 'approved'){
		phaseChange(responseField, 6);
	} else if (responseField.value == 'denied'){
		phaseChange(responseField, 12);
	};
}
const checkIfEnterKey = (input,event) => {
	if (event.keyCode == 13) {
		console.log(input.value)
		input.blur();
	}
}

const revealNextNotSatisfiedStep = (selectField, stepToReveal) => {
	if(selectField.id != 'approval_contacted_dss') {
		if (selectField.value == "no") {
			const ul = selectField.parentNode.parentNode.parentNode.parentNode;
			const element = ul.querySelector(`.notSatisfied${stepToReveal}`)
			$(element).fadeIn();
		} else if (selectField.value == "yes") {
			document.querySelector('.overlay').style.display = "block";
		};
	} else {
		if (selectField.value == "yes") {
			const ul = selectField.parentNode.parentNode.parentNode.parentNode;
			const element = ul.querySelector(`.notSatisfied${stepToReveal}`)
			$(element).fadeIn();
		}
	}
}

const createNewApp = () => {
	const ajaxCall = $.ajax(
		{
			type:"GET",
			url: `/application/ajax/create_application`,
			data: {
				resident_id: residentId
			},
			success: function(appId) {
				location.reload();
				console.log(` Your new app's id is: ${appId}`)
			}
		});
}

const deleteDoc = (table,tableRowId,docField) => {
	if (confirm("Remove this document?")) {
		const successMessage = `${docField} field in ${table} table set to null`;
		const dataObject =  {
			row_id: tableRowId,
			column: docField,
			new_value: null
		};
		updateDB(table, dataObject, successMessage) 
		location.reload();		
	}		
}

const deleteResponse = (responseType,responseId) => {
	if (confirm("Delete this response and all its data?")) {
		const ajaxCall = $.ajax(
		{
			type:"GET",
			url: `/application/ajax/delete_response`,
			data: {
				response_type: responseType,
				response_id: responseId
			},
			success: function() {
				const section = document.querySelector(`#${responseType}${responseId}`)
				$(section).fadeOut()
				console.log("Response deleted")
			}
		});
	}
}

</script>
{% endblock %}